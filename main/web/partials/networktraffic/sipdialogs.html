<div id="sipdialogs" ng-controller="SIPDialogs">

    <section ng-include="'/partials/networktraffic/snapshotfilter.html'"
        ng-show="filterDisplayed" ng-controller="DialogFilter"></section>

    <div class="dialog" ng-repeat="dialog in dialogs.sipdialogs">
        <table class="table">
            <tbody>
                <tr>
                    <th>Call-id</th>
                    <td>{{dialog.call_id}}</td>
                </tr>
                <tr>
                    <th>Local Tag</th>
                    <td>{{dialog.local_tag}}</td>
                </tr>
                <tr>
                    <th>Remote Tag</th>
                    <td>{{dialog.remote_tag}}</td>
                </tr>
                <tr>
                    <th>Participants</th>
                    <td>{{dialog.sender}}<br>{{dialog.receiver}}</td>
                </tr>
                <tr>
                    <th>SIP Messages</th>
                    <td>{{dialog.messages.length}}</td>
                </tr>
            </tbody>
        </table>

        <div ng-controller="DialogMessages">

            <a ng-click="toggleDisplayed()" ng-hide="messages.displayed">Show network messages</a>
            <a ng-click="toggleDisplayed()" ng-show="messages.displayed">Hide network messages</a>

            <div ng-show="messages.displayed">
        
                <div class="info networkmessage" ng-repeat="networkmessage in messages.messages | orderBy:messages.sortby">

                    <div id="message-view-selector">
            
                        <select ng-model="networkmessage.view" ng-options="view for view in messages.views">
                        </select>

                        <a ng-hide="isTagged($index)" ng-click="toggleTag($index)">Tag</a>
                        <a ng-show="isTagged($index)" ng-click="toggleTag($index)">Untag</a>

                    </div>

                    <div ng-switch on="networkmessage.view">

                        <table class="table" ng-switch-when="Details">
                            <tbody>
                                <tr>
                                    <th>Time</th>
                                    <td>{{networkmessage.utc | precisedate}}</td>
                                </tr>
                                <tr>
                                    <th>Protocol</th>
                                    <td>{{networkmessage.protocol}}/{{networkmessage.version}}</td>
                                </tr>
                                <tr>
                                    <th>Method</th>
                                    <td>{{networkmessage.method}}</td>
                                </tr>
                                <tr>
                                    <th>Status</th>
                                    <td>{{networkmessage.status}}</td>
                                </tr>
                                <tr>
                                    <th>Source</th>
                                    <td>{{networkmessage.source}}{{networkmessage.source_port | formatport}}</td>
                                </tr>
                                <tr>
                                    <th>Destination</th>
                                    <td>{{networkmessage.destination}}{{networkmessage.destination_port | formatport}}</td>
                                </tr>
                            </tbody>
                        </table>

                        <table class="table" ng-switch-when="Headers">
                            <tbody>
                                <tr ng-repeat="header in networkmessage.headers">
                                    <th>{{header.name}}</th>
                                    <td>{{header.value}}</td>
                                </tr>
                            </tbody>
                        </table>

                        <p ng-switch-when="Content">{{networkmessage.content}}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>